{% extends "base.html" %}

{% block title %}PIKA - Audit Logs{% endblock %}

{% block content %}
<!-- Header -->
<header class="header">
    <div class="header-left">
        <a href="/" class="logo">PIKA</a>
        <span class="header-divider">/</span>
        <span class="header-title">Audit Logs</span>
    </div>
    <a href="/admin" class="header-link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back to Admin
    </a>
</header>

<div class="logs-container">
    <div class="logs-header">
        <h1 class="logs-title">Recent Activity</h1>
        <span style="color: var(--text-secondary); font-size: 14px;">
            Last {{ logs|length }} events
        </span>
    </div>

    {% if logs %}
        {% for log in logs %}
        <div class="log-entry">
            <div class="log-entry-header">
                <span class="log-event log-event-{{ log.event }}">{{ log.event }}</span>
                <span class="log-timestamp">{{ log.timestamp }}</span>
            </div>
            <div class="log-content">
                {% if log.event == 'query' %}
                    <strong>Question:</strong> {{ log.question[:100] }}{% if log.question|length > 100 %}...{% endif %}<br>
                    <strong>Model:</strong> {{ log.model }} |
                    <strong>Confidence:</strong> {{ log.confidence }} |
                    <strong>Sources:</strong> {{ log.sources|length }}
                    {% if log.error %}<br><strong>Error:</strong> {{ log.error }}{% endif %}
                {% elif log.event == 'admin' %}
                    <strong>Action:</strong> {{ log.action }}
                    {% if log.details %}
                        <br><strong>Details:</strong>
                        {% for key, value in log.details.items() %}
                            {{ key }}={{ value }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    {% endif %}
                {% elif log.event == 'auth' %}
                    <strong>Action:</strong> {{ log.action }} |
                    <strong>Success:</strong> {{ log.success }} |
                    <strong>IP:</strong> {{ log.ip_address or 'unknown' }}
                {% else %}
                    {{ log }}
                {% endif %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="logs-empty">
            <p>No audit logs yet</p>
        </div>
    {% endif %}
</div>
{% endblock %}
